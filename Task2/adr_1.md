### **Название задачи:**

MVP платформы мониторинга скота — Основное решение

### **Автор:**

Pavel Shatskikh

### **Дата:**

2025-07-20

### **Функциональные требования**

| **№** | **Действующие лица или системы** | **Use Case**                    | **Описание**                                                                                       |
|:-----:|:---------------------------------|:--------------------------------|:---------------------------------------------------------------------------------------------------|
|   1   | Система, Фермер                  | Мониторинг поведения животных   | Фиксация признаков беспокойства, драк или задавливания поросят, оповещение оператора.              |
|   2   | Система, Фермер                  | Управление кормлением           | Управление кормушками и поилками разных производителей.                                            |
|   3   | Система, Ветеринар               | Оценка состояния животных       | Определение болезни, гибели или беспокойства по поведению и внешнему виду.                         |
|   4   | Система, Фермер                  | Управление водой                | Мониторинг фильтрации воды и уведомление о проблемах.                                              |
|   5   | Система, Фермер                  | Пересчет поголовья              | Подсчет животных в режиме реального времени.                                                       |
|   6   | Система, Фермер                  | Мониторинг запасов              | Учет и прогнозирование расхода корма.                                                              |
|   7   | Система, IoT-датчики             | Сбор данных                     | Обработка данных от видеокамер и IoT-датчиков.                                                     |
|   8   | Система, Оператор                | Работа offline                  | Работа при отсутствии интернета и синхронизация с центральным сервером после восстановления связи. |
|   9   | Система, DevOps                  | Интеграция с внешними системами | Передача метрик и API для мобильных и веб-приложений.                                              |

### **Нефункциональные требования**

| **№** | **Требование**                                                                                    |
|:-----:|:--------------------------------------------------------------------------------------------------|
|   1   | Отказоустойчивость 99,95%.                                                                        |
|   2   | Расширяемость архитектуры, возможность добавления новых функций без изменений существующего кода. |
|   3   | Время реакции на нештатную ситуацию — не более 5 секунд.                                          |
|   4   | Видеоаналитика в реальном времени с минимальными задержками (миллисекунды).                       |
|   5   | Поддержка работы offline и синхронизация после восстановления связи.                              |
|   6   | Современные способы аутентификации и авторизации, разделение ролей.                               |

### **Решение**

Основное решение основано на **центральном сервере** и **тонких агентах** на фермах.  
Архитектура представлена в C2-диаграмме: [c2](c2_1.puml).

**Ключевая логика:**

- Централизация аналитики и отчетности.
- Упрощенная синхронизация данных через агентов.
- Удобное масштабирование для SaaS.

**Технологический стек:**

- **Микросервисы:** Kotlin + Spring Boot.
- **Агенты:** Rust (edge-обработка данных).
- **Хранилище данных:** TimescaleDB (time-series), PostgreSQL.
- **Аутентификация:** Keycloak.
- **API Gateway:** Spring Cloud Gateway API.
- **Очереди и брокеры сообщений:** Kafka или RabbitMQ.

### **Альтернативы**

- Толстые агенты с локальной аналитикой и минимальным центральным сервером (см. ADR альтернативного решения).

### **Компромиссы и риски**

- Зависимость от центрального сервера и связи с ним.
- Повышенная нагрузка на центральную инфраструктуру.
- Проще развивать SaaS, но сложнее обеспечить работу при постоянных перебоях с интернетом.
